<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Stickman Dunk Run - 立体像素跑酷</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  font-family: "微软雅黑";
  background: linear-gradient(to top, #87ceeb, #ccefff); /* 天空渐变 */
}

#gameCanvas {
  display: block;
  background: transparent;
}

#score {
  position: absolute;
  top: 10px;
  left: 10px;
  font-size: 22px;
  font-weight: bold;
  color: #fff;
  text-shadow: 1px 1px 2px #000;
  z-index: 10;
}

#characterSelect {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

.character-btn {
  display: inline-block;
  margin: 10px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
  border-radius: 8px;
  border: 2px solid #444;
  background: #fff;
  font-weight: bold;
}
.character-btn:hover {
  background: #eee;
}
</style>
</head>
<body>

<div id="score">分数: 0</div>

<div id="characterSelect">
  <h2>选择角色</h2>
  <button class="character-btn" data-character="0">爸爸</button>
  <button class="character-btn" data-character="1">Lucky</button>
  <button class="character-btn" data-character="2">刘大力</button>
  <button class="character-btn" data-character="3">nn</button>
</div>

<canvas id="gameCanvas" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const characterSelectDiv = document.getElementById('characterSelect');
const buttons = document.querySelectorAll('.character-btn');

const canvasWidth = canvas.width;
const canvasHeight = canvas.height;

let gameInterval;
let score = 0;
let speed = 4;
let gravity = 0.8;

// 角色定义（方块像素立体风）
const characters = [
  { name: "爸爸", color: "#ff6666", width: 40, height: 50, armOffset: 5, legOffset: 5 },
  { name: "Lucky", color: "#66ccff", width: 35, height: 45, armOffset: 4, legOffset: 4 },
  { name: "刘大力", color: "#ffcc99", width: 35, height: 45, armOffset: 4, legOffset: 4 },
  { name: "nn", color: "#cccccc", width: 35, height: 40, armOffset: 3, legOffset: 3 },
];

let currentCharacter = null;

const player = {
  x: 100,
  y: canvasHeight - 50,
  width: 40,
  height: 50,
  vy: 0,
  jumping: false,
  color: "#ff6666"
};

let obstacles = [];

// 生成障碍物
function spawnObstacle() {
  const heights = [30, 40, 50, 60];
  const size = heights[Math.floor(Math.random()*heights.length)];
  const colors = ["#ff9900","#ff6600","#ffaa33"];
  obstacles.push({
    x: canvasWidth + 50,
    y: canvasHeight - size - 10,
    width: 20,
    height: size,
    color: colors[Math.floor(Math.random()*colors.length)]
  });
}

// 键盘跳跃
document.addEventListener('keydown', (e) => {
  if ((e.code === "Space" || e.code === "ArrowUp") && !player.jumping) {
    player.vy = -12;
    player.jumping = true;
  }
});

// 颜色亮度变化
function lightenColor(hex, percent) {
  let num = parseInt(hex.replace("#",""),16);
  let r = (num >> 16) + percent;
  let g = ((num >> 8) & 0x00FF) + percent;
  let b = (num & 0x0000FF) + percent;
  r = r>255?255:r; g = g>255?255:g; b = b>255?255:b;
  return "#" + (r<<16 | g<<8 | b).toString(16).padStart(6,'0');
}

// 绘制立体角色
function drawPlayer() {
  const color = player.jumping ? lightenColor(player.color,20) : player.color;
  const char = currentCharacter;
  // 身体
  ctx.fillStyle = color;
  ctx.fillRect(player.x, player.y, player.width, player.height);

  // 手臂（跳跃时抬起）
  ctx.fillStyle = lightenColor(color,10);
  let armShift = player.jumping ? -5 : 0;
  ctx.fillRect(player.x - char.armOffset, player.y + 5 + armShift, 5, 15); // 左手
  ctx.fillRect(player.x + player.width, player.y + 5 + armShift, 5, 15); // 右手

  // 腿部（跳跃时抬腿）
  let legShift = player.jumping ? -5 : 0;
  ctx.fillRect(player.x + 5, player.y + player.height - 10 + legShift, 8, 10); // 左腿
  ctx.fillRect(player.x + player.width - 13, player.y + player.height -10 + legShift, 8, 10); // 右腿
}

// 背景绘制
function drawBackground() {
  ctx.fillStyle = "#77bb44";
  ctx.fillRect(0, canvasHeight-10, canvasWidth, 10);

  // 操场格子
  ctx.strokeStyle = "#66aa33";
  for (let i=0; i<canvasWidth; i+=40) {
    ctx.beginPath();
    ctx.moveTo(i, canvasHeight-10);
    ctx.lineTo(i, canvasHeight-50);
    ctx.stroke();
  }
  for (let i=canvasHeight-10; i>canvasHeight-150; i-=20) {
    ctx.beginPath();
    ctx.moveTo(0,i);
    ctx.lineTo(canvasWidth,i);
    ctx.stroke();
  }

  // 远景建筑
  ctx.fillStyle = "#bbbbbb";
  for (let i=0; i<canvasWidth*2; i+=200) {
    let offset = (i - score*0.5) % (canvasWidth*2);
    ctx.fillRect(offset, canvasHeight-100, 50, 90);
  }

  // 像素树
  ctx.fillStyle = "#336633";
  for (let i=0; i<canvasWidth; i+=150) {
    let offset = (i - score*0.7) % canvasWidth;
    ctx.fillRect(offset, canvasHeight-60, 10, 40);
    ctx.fillRect(offset-5, canvasHeight-70, 20, 10);
  }
}

// 游戏循环
function gameLoop() {
  ctx.clearRect(0, 0, canvasWidth, canvasHeight);
  drawBackground();

  // 更新玩家位置
  player.y += player.vy;
  player.vy += gravity;
  if (player.y + player.height >= canvasHeight - 10) {
    player.y = canvasHeight - 10 - player.height;
    player.vy = 0;
    player.jumping = false;
  }

  drawPlayer();

  // 绘制障碍物
  for (let i = obstacles.length -1; i >=0; i--) {
    let obs = obstacles[i];
    obs.x -= speed;
    ctx.fillStyle = obs.color;
    ctx.fillRect(obs.x, obs.y, obs.width, obs.height);

    if (player.x < obs.x + obs.width &&
        player.x + player.width > obs.x &&
        player.y < obs.y + obs.height &&
        player.y + player.height > obs.y) {
      clearInterval(gameInterval);
      alert("游戏结束! 总分: " + Math.floor(score));
      resetGame();
      return;
    }

    if (obs.x + obs.width < 0) obstacles.splice(i, 1);
  }

  if (Math.random() < 0.02) spawnObstacle();

  score += 0.1;
  scoreEl.textContent = "分数: " + Math.floor(score);
}

// 选择角色
buttons.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const idx = parseInt(btn.getAttribute('data-character'));
    currentCharacter = characters[idx];
    player.width = currentCharacter.width;
    player.height = currentCharacter.height;
    player.color = currentCharacter.color;
    characterSelectDiv.style.display = "none";
    startGame();
  });
});

function startGame() {
  score = 0;
  obstacles = [];
  player.x = 100;
  player.y = canvasHeight - player.height - 10;
  player.vy = 0;
  player.jumping = false;
  gameInterval = setInterval(gameLoop, 20);
}

function resetGame() {
  characterSelectDiv.style.display = "block";
  player.width = 40;
  player.height = 50;
  player.color = "#ff6666";
}

</script>
</body>
</html>
